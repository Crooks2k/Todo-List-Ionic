<div class="category-selector" (click)="openModal()">
  <div class="selector-content">
    @if (selectedCategory) {
    <div class="selected-category">
      <ion-icon
        [name]="getCategoryIcon(selectedCategory)"
        [style.color]="selectedCategory.color"
      ></ion-icon>
      <span>{{ selectedCategory.name }}</span>
    </div>
    } @else {
    <span class="placeholder">{{ labels.placeholder }}</span>
    }
  </div>
  <ion-icon name="chevron-down" class="chevron"></ion-icon>
</div>

<ion-modal
  [isOpen]="showModal"
  (didDismiss)="closeModal()"
  [backdropDismiss]="true"
  [cssClass]="config.modal.cssClass"
>
  <ng-template>
    <ion-header class="ion-no-border">
      <ion-toolbar>
        <ion-title>{{ labels.modalTitle }}</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeModal()">
            <ion-icon name="close" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
      <ion-toolbar>
        <ion-searchbar
          [(ngModel)]="searchTerm"
          [placeholder]="labels.searchPlaceholder"
          [debounce]="config.search.debounce"
          animated
        ></ion-searchbar>
      </ion-toolbar>
    </ion-header>

    <ion-content class="modal-content">
      @if (!hasCategories) {
      <div class="empty-state">
        <ion-icon name="pricetags-outline"></ion-icon>
        <p>{{ labels.noCategories }}</p>
      </div>
      } @else if (!hasFilteredResults) {
      <div class="empty-state">
        <ion-icon name="search-outline"></ion-icon>
        <p>{{ labels.noResults }}</p>
      </div>
      } @else {
      <ion-list lines="none">
        @for (category of filteredCategories; track category.id) {
        <ion-item
          button
          (click)="selectCategory(category.id)"
          [class.selected]="category.id === selectedCategoryId"
          class="category-item"
        >
          <ion-icon
            [name]="getCategoryIcon(category)"
            [style.color]="category.color"
            slot="start"
            class="category-icon"
          ></ion-icon>
          <ion-label>{{ category.name }}</ion-label>
          @if (category.id === selectedCategoryId) {
          <ion-icon name="checkmark" slot="end" color="primary"></ion-icon>
          }
        </ion-item>
        }
      </ion-list>
      }
    </ion-content>
  </ng-template>
</ion-modal>
